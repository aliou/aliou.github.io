<!DOCTYPE html>
<html>
  <head>
    
  <title>Using named captures to extract information from Strings &mdash; Aliou Diallo</title>
  <meta name='og:title' content="Using named captures to extract information from Strings - Aliou Diallo" />


<meta name='twitter:site' content='@aliouftw' />
<meta name='twitter:title' content='Aliou Diallo' />


  <meta name='twitter:title' content="Using named captures to extract information from Strings &mdash; Aliou Diallo" />



  <meta name='description' content="Regular expressions' named captures are an elegant way to parse and extract data from strings.
" />
  <meta name='og:description' content="Regular expressions' named captures are an elegant way to parse and extract data from strings.
" />
  <meta name='twitter:description' content="Regular expressions' named captures are an elegant way to parse and extract data from strings.
" />



  <meta property="twitter:card" content="summary_large_image">



    <meta charset="UTF-8">
    <meta name="google-site-verification" content="QnLybeTUEt_VtHQVLLtEz0WflVe-H7TNqCOTlF-tfz8" />
    <meta name='author' content='Aliou Diallo' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link href="/posts/2020/04/regexp-named-captures/" rel="canonical" />

    <link rel="stylesheet" type="text/css" href="/assets/styles.css">
    <link rel="stylesheet" type="text/css" href="/assets/base16-default.dark.css">
    <link rel="stylesheet" type="text/css" href="/assets/base16-default.light.css">
  </head>
  <body class='container'>
    <header>
  <h1 class="header-title">
    <a class='header-link not-underlined' href="/">Aliou Diallo</a>
  </h1>
  <nav class="header-nav">
    <a class='not-underlined header-link' href="/posts">Posts</a>
    <a class='not-underlined header-link' href="https://twitter.com/aliouftw" target='_blank'>Twitter</a>
    <a class='not-underlined header-link' href="https://github.com/aliou" target='_blank'>GitHub</a>
    <a class='not-underlined header-link' href="https://hachyderm.io/@aliouftw" rel="me">Mastodon</a>
  </nav>
</header>

    <main class='content'>
      <article class='post-container'>
  <h1 class='archive-post-title'>
    <a class='header-link not-underlined' href='/posts/2020/04/regexp-named-captures/'>
      Using named captures to extract information from Strings
    </a>
  </h1>
  <time class="f6 tracked gray">April 9, 2020</time>
  

  <p class="f4 lh-title"><p>For an internal project at work, I recently had to parse the names of Heroku <a href="https://devcenter.heroku.com/articles/github-integration-review-apps-old">review applications</a> to retrieve some data. The application names looked like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project_name&gt;-pr-&lt;pull_request_id&gt;
</code></pre></div></div>

<p>At first, since each part I needed was separated by a dash, I had some code that looked like this:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="n">project_name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">pull_request_id</span> <span class="o">=</span> <span class="n">application_name</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span>
<span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span>
</code></pre></div></div>

<p>Because the project name could also have some dashes in it, I needed to rejoin it after extracting the pull request data.
At first, for a prototype, this worked fine. But when this internal project transitioned into being an important part of my team’s tooling, I started looking at a better and cleaner way to achieve the same result.</p>

<p>Since we were already validating the format of the application name with a regular expression, I figured I’d use it to also retrieve the data using named captures.</p>

<h2 id="regular-expressions-in-ruby">Regular expressions in Ruby</h2>

<p>For a refresher on a <a href="https://www.rubyguides.com/2015/06/ruby-regex/">regular expressions</a>, I highly recommend <a href="https://daneden.me/2019/11/23/regex-for-designers-and-writers/">this article</a><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup> by <a href="https://daneden.me">Dan Eden</a>.</p>

<p>As a reminder, there are multiple ways to create regular expressions in Ruby:</p>
<ul>
  <li>Using <code class="highlighter-rouge">/xxxx/</code></li>
  <li>Using percent literal : <code class="highlighter-rouge">%r{}</code></li>
  <li>Using the class initializer: <code class="highlighter-rouge">Regexp#new</code></li>
</ul>

<p>With your newly created regular expression, there are two main ways to check if a string matches a regular expression:</p>

<ul>
  <li>Calling <code class="highlighter-rouge">String#match</code> with the regular expression as argument:
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'abc'</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/a/</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;MatchData "a"&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>Calling <code class="highlighter-rouge">Regexp#match</code> on the regular expression with the string as argument:
    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/a/</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;MatchData "a"&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>If the String matches the regular expression, it will return a <a href="https://www.rubydoc.info/stdlib/core/MatchData"><code class="highlighter-rouge">MatchData</code></a> object, otherwise it will return <code class="highlighter-rouge">nil</code>. The <a href="https://www.rubydoc.info/stdlib/core/MatchData"><code class="highlighter-rouge">MatchData</code></a> object encapsulates the result of matching a String against a Regexp, including the different submatches. It also contains the eventual captures and named captures.</p>

<h2 id="named-captures">Named captures</h2>

<p>Named captures allow you to describe submatches of a regular expression and then retrieve them from the resulting <a href="https://www.rubydoc.info/stdlib/core/MatchData"><code class="highlighter-rouge">MatchData</code></a> object. In our case, our regular expression looked like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/.*-pr-\d+/</span>
</code></pre></div></div>

<p>To use named captures, we first need to add capture them into groups to our regular expressions. Adding capture groups is as simple as wrapping them inside parentheses:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/(.*)-pr-(\d+)/</span>
</code></pre></div></div>

<p>Finally, name the different captures. To do this, we need to prefix the content of the capture group with its name:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/(?&lt;project_name&gt;.*)-pr-(?&lt;pull_request_id&gt;\d+)/</span>
</code></pre></div></div>

<p>Now that we’ve done this, we can easily retrieve the data we want from the application name using our resulting object:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">expression</span> <span class="o">=</span> <span class="sr">/(?&lt;project_name&gt;.*)-pr-(?&lt;pull_request_id&gt;\d+)/</span>
<span class="n">application_name</span> <span class="o">=</span> <span class="s1">'my_app-pr-1234'</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">expression</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">application_name</span><span class="p">)</span>

<span class="n">matches</span><span class="p">[</span><span class="ss">:project_name</span><span class="p">]</span> <span class="c1"># =&gt; 'my_app'</span>
<span class="n">matches</span><span class="p">.</span><span class="nf">named_captures</span> <span class="c1"># =&gt; {"project_name"=&gt;"my_app", "pull_request_id"=&gt;"1234"}</span>
</code></pre></div></div>

<hr />

<p><small>Thanks to <a href="https://twitter.com/caouibachir" target="_blank">Bachir Çaoui</a>, Alexis Woo and Alexis Focheux for reviewing draft versions of this post.</small></p>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>While the article is intended for designers and UX writers, I found that it was an excellent introduction to regular expressions for everyone. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
</p>
</article>

    </main>
  </body>
  <script src="/assets/app.js" type="text/javascript"></script>
</html>
